<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
#ConfigSection
데이터베이스에 질의할 구문을 작성하는곳
 -->

<mapper namespace="users">
	<select id="userList" resultType="map">		
		select d.dept_nm, b.emp_nm, v.cust_nm, a.* 
			from scu100 a			
			left join hra200 d	on	d.dept_cd = a.dept_cd
			left join hra100 b on a.emp_no  = b.emp_no
		    left join bcv100 v	on	v.cust_cd = a.cust_cd
	</select>

	<select id="userInfoById" parameterType="map" resultType="map">
		select d.dept_nm, b.emp_nm, v.cust_nm, time_out = ISNULL(x.m5,''), a.* 
			from scu100 a			
			left join hra200 d	on	d.dept_cd = a.dept_cd
			left join hra100 b on a.emp_no  = b.emp_no
		    left join bcv100 v	on	v.cust_cd = a.cust_cd
		    left join bca200V x on x.base_cd = a.usr_ty
		    where a.ID = #{userSysId}
	</select>

	<select id="userInfoByPassword" parameterType="map" resultType="map">
		select d.dept_nm, b.emp_nm, v.cust_nm, a.* 
			from scu100 a			
			left join hra200 d	on	d.dept_cd = a.dept_cd
			left join hra100 b on a.emp_no  = b.emp_no
		    left join bcv100 v	on	v.cust_cd = a.cust_cd
		    where a.ID = #{userSysId} and PWDCOMPARE(#{token},a.pwd)=1 and a.usr_ty='SC700100'
	</select>

	<select id="checkFormOpened" parameterType="map" resultType="map">
		select top 1 frm_cd 
		from scu200 a
		left join scu100 b on a.reg_id = b.reg_id
		where b.id = #{userSysId}
		order by use_dt desc
	</select>
	
	<select id="userSecurity" parameterType="map" resultType="map">
		 select 
			a.nm,
			policy_use=b.m1,time_out = b.m5,
			password_length = c.m1,include_digit = c.m2,include_char=c.m3,special_char=c.m4,sequential_chr = c.m5,fail_allow_count=c.m6,valid_period = c.m7
		from scu100 a
			left join bca200v b on b.base_cd = a.usr_ty
			left join bca200v c on c.base_cd = 'SC701100'
		where
			a.id = #{userSysId}
	</select>	
	
	<update id="updatePwd">
		update a set a.pwd = PWDENCRYPT(#{token}) ,a.pwd_dt = getdate()
		from scu100 a where a.id = #{userSysId}
	</update>
</mapper>

<!-- 
USERNO INT GENERATED BY DEFAULT AS IDENTITY 
          (START WITH 1, INCREMENT BY 1) NOT NULL,
    USERID VARCHAR(45) NOT NULL,
	USERNAME VARCHAR(45) NOT NULL,
	PASSWORD VARCHAR(45) NOT NULL,
 -->