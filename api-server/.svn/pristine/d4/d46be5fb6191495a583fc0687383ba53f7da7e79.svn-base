<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
#ConfigSection
데이터베이스에 질의할 구문을 작성하는곳
 -->

<mapper namespace="jumps">

	<select id="initInfoByRegid" parameterType="map" resultType="map">
	select	a.reg_id, a.id, new_pwd = '', a.pwd, a.nm, a.usr_ty, a.emp_no, a.cust_cd, v.cust_nm, a.system_cd, a.lan_cd, 
		a.grid_skin_nm, a.skin_nm, 
		a.ent_ty, a.co_cd, a.bs_cd, a.div_cd, a.dept_cd, d.dept_nm, a.fac_cd, a.init_yn, a.init_frm, 
		a.use_yn, a.fnt_nm, a.fnt_siz, a.dsc, a.cid, a.cdt, a.mid, a.mdt,
		host_nm  = (select top 1 z.host_nm  from scu210 z where z.id = a.id order by z.login_dt desc),
		ip_addr  = (select top 1 z.ip_addr  from scu210 z where z.id = a.id order by z.login_dt desc),
		mac_addr = (select top 1 z.mac_addr from scu210 z where z.id = a.id order by z.login_dt desc),
		adap_nm  = (select top 1 z.adap_nm  from scu210 z where z.id = a.id order by z.login_dt desc),
		log_cnt  = (select count(0) from scu210 z where z.id = a.id), a.pwd_dt,
		m1_cnt   = 77.123,--(select count(0) from scu210 z where z.id = a.id and z.login_dt >= dateadd(month, -1, getdate())),
		ng_cnt   = (select count(0) from scu210 z where z.id = a.id and z.login_dt >= dateadd(month, -1, getdate())  and z.ok_yn = '0')
	from	scu100 a
		left join hra200 d	on	d.dept_cd = a.dept_cd
		left join bcv100 v	on	v.cust_cd = a.cust_cd
	where	1=1
		and a.reg_id = #{reg_id}
	</select>
	
	<update id="setInitFormByRegid" parameterType="map">
		update a
		set a.init_frm = #{frm_nm},
			a.init_yn = case when #{frm_nm}='' then '0'
							 else '1'
						end
		from scu100 a
		where a.reg_id = #{reg_id}
	</update>

</mapper>


<!-- 
USERNO INT GENERATED BY DEFAULT AS IDENTITY 
          (START WITH 1, INCREMENT BY 1) NOT NULL,
    USERID VARCHAR(45) NOT NULL,
	USERNAME VARCHAR(45) NOT NULL,
	PASSWORD VARCHAR(45) NOT NULL,
 -->